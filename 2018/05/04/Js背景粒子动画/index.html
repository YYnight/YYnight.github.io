<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Devil"><title>Js背景粒子动画 . Devil的博客</title><meta name="description" content="&amp;emsp;看到许多大神写的各种js动画插件，觉得特别nice，刚好身边有一份粒子动画的源码，不过存在部分bug，本着边用边学的精神，深入学习了这段代码，并修复了其中存在的问题，有可能以后还能用到，在这记录一下。12345678910111213141516171819202122232425262"><meta name="keywords" content="Devil,技术,java,React"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/code_style_dark.css"><script src="/js/scrollReveal.js"></script><script src="/js/jquery.min.js"></script><script src="/js/jscex.min.js"></script><script src="/js/jscex-parser.js"></script><script src="/js/jscex-jit.js"></script><script src="/js/jscex-builderbase.min.js"></script><script src="/js/jscex-async.min.js"></script><script src="/js/jscex-async-powerpack.min.js"></script><script src="/js/functions.js"></script><script src="/js/love.js"></script><script src="/js/filter.js"></script><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></head><body><div class="header"><div id="banner"><img src="/images/logo.jpg" class="head"><h2 id="mmenu"><span class="navicon"></span></h2><div id="slider"><li><a href="/">首页</a></li><li><a href="/blog">博客</a></li><li><a href="/life">生活</a></li><li><a href="/archives">归档</a></li><li><a href="/about">关于我</a></li><li><a href="/code">短码</a></li><li><a href="/photos">相册</a></li></div></div><script type="text/javascript">var mmenu = document.getElementById("mmenu");
var slider = document.getElementById("slider");
mmenu.onclick = function() {
var style = slider.style;
slider.style.display = style.display == "block" ? "none" : "block"
mmenu.className = style.display == "block" ? "open" : ""
}
var as = slider.getElementsByTagName('a');
obj = as[0];
for (var i = 1; i < as.length; i++) {
if (window.location.href.indexOf(as[i].href) >= 0) {
obj = as[i];
}
}
obj.id = 'selected'</script></div><div class="line60"></div><div class="blank"></div><div id="main"><div class="blogcontent size-controll"><div class="pagecontent fadeIn content"><div class="post animated fadeInDown"><div class="post-title"><h3><a>Js背景粒子动画</a></h3></div><div class="post-content"><p>&emsp;看到许多大神写的各种js动画插件，觉得特别nice，刚好身边有一份粒子动画的源码，不过存在部分bug，本着边用边学的精神，深入学习了这段代码，并修复了其中存在的问题，有可能以后还能用到，在这记录一下。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> conf = &#123;</span><br><span class="line">    count: <span class="number">150</span>,</span><br><span class="line">    r1: <span class="number">85</span>,</span><br><span class="line">    r2: <span class="number">100</span>,</span><br><span class="line">    opacity: <span class="number">.7</span>,</span><br><span class="line">    color: <span class="string">'#000'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> canvas,ctx;</span><br><span class="line"><span class="keyword">const</span> ww = <span class="built_in">window</span>.innerWidth;</span><br><span class="line"><span class="keyword">const</span> wh = <span class="built_in">window</span>.innerHeight;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> nodes = [];</span><br><span class="line"><span class="keyword">let</span> cnode = &#123;</span><br><span class="line">    x:<span class="number">0</span>,</span><br><span class="line">    y:<span class="number">0</span>,</span><br><span class="line">    dx:<span class="number">0</span>,</span><br><span class="line">    dy:<span class="number">0</span>,</span><br><span class="line">    r:<span class="number">0</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    canvas = <span class="built_in">document</span>.createElement(<span class="string">'canvas'</span>);</span><br><span class="line">    ctx = canvas.getContext(<span class="string">'2d'</span>);</span><br><span class="line">    canvas.style.zIndex = <span class="string">'-1'</span>;</span><br><span class="line">    canvas.style.position = <span class="string">'fixed'</span>;</span><br><span class="line">    canvas.style.left = <span class="number">0</span>;</span><br><span class="line">    canvas.style.top = <span class="number">0</span>;</span><br><span class="line">    canvas.style.opacity = conf.opacity;</span><br><span class="line">    canvas.width = ww;</span><br><span class="line">    canvas.height = wh;</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(canvas);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; conf.count; i++)&#123;</span><br><span class="line">        nodes.push(&#123;</span><br><span class="line">            x: <span class="built_in">Math</span>.random() * ww,</span><br><span class="line">            y: <span class="built_in">Math</span>.random() * wh,</span><br><span class="line">            dx: <span class="built_in">Math</span>.random() * <span class="number">2</span> - <span class="number">1</span>,</span><br><span class="line">            dy: <span class="built_in">Math</span>.random() * <span class="number">2</span> - <span class="number">1</span>,</span><br><span class="line">            r : conf.r1</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    nodes.push(cnode);</span><br><span class="line">    render();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">document</span>.body.onmousemove = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> e = event || <span class="built_in">window</span>.event;</span><br><span class="line">        cnode.x = e.clientX;</span><br><span class="line">        cnode.y = e.clientY;</span><br><span class="line">        cnode.r = conf.r2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">document</span>.body.onmouseleave = <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">        cnode.x = <span class="number">0</span>;</span><br><span class="line">        cnode.y = <span class="number">0</span>;</span><br><span class="line">        cnode.r = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseColor</span>(<span class="params">c,a</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> rgba = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>];</span><br><span class="line">    <span class="keyword">if</span>(c.length === <span class="number">4</span>) &#123;</span><br><span class="line">        rgba = <span class="built_in">Array</span>.prototype.slice.call(c,<span class="number">1</span>).map(<span class="function">(<span class="params">i</span>) =&gt;</span> <span class="built_in">parseInt</span>(i,<span class="number">16</span>))</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        rgba[<span class="number">0</span>] = <span class="built_in">parseInt</span>(c.substr(<span class="number">1</span>,<span class="number">2</span>), <span class="number">16</span>) || <span class="number">0</span>;</span><br><span class="line">        rgba[<span class="number">1</span>] = <span class="built_in">parseInt</span>(c.substr(<span class="number">3</span>,<span class="number">2</span>), <span class="number">16</span>) || <span class="number">0</span>;</span><br><span class="line">        rgba[<span class="number">2</span>] = <span class="built_in">parseInt</span>(c.substr(<span class="number">5</span>,<span class="number">2</span>), <span class="number">16</span>) || <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    rgba.push(a);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'rgba('</span> + rgba.join(<span class="string">','</span>) + <span class="string">')'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    ctx.clearRect(<span class="number">0</span>, <span class="number">0</span>, ww, wh);</span><br><span class="line">    nodes.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">node, index</span>)</span>&#123;</span><br><span class="line">        ctx.fillRect(node.x - <span class="number">.5</span>, node.y - <span class="number">.5</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i = index + <span class="number">1</span>; i &lt; nodes.length; i++)&#123;</span><br><span class="line">            <span class="keyword">let</span> n = nodes[i];</span><br><span class="line">            <span class="keyword">let</span> dx = n.x - node.x;</span><br><span class="line">            <span class="keyword">let</span> dy = n.y - node.y;</span><br><span class="line">            <span class="keyword">let</span> r2 = n.r * n.r;</span><br><span class="line">            <span class="keyword">let</span> d2 = dx * dx + dy * dy;</span><br><span class="line">            <span class="keyword">let</span> rt = <span class="number">1</span> - d2 /r2;</span><br><span class="line">            <span class="keyword">if</span>(d2 &lt; r2)&#123;</span><br><span class="line">                ctx.beginPath();</span><br><span class="line">                ctx.lineWidth = rt/<span class="number">2</span>;</span><br><span class="line">                ctx.strokeStyle = parseColor(conf.color,rt);</span><br><span class="line">                ctx.moveTo(n.x,n.y);</span><br><span class="line">                ctx.lineTo(node.x, node.y);</span><br><span class="line">                ctx.stroke();</span><br><span class="line">                <span class="keyword">if</span>(n === cnode &amp;&amp; d2 &gt; r2 / <span class="number">2</span>)&#123;</span><br><span class="line">                    node.x += dx * <span class="number">0.03</span>;</span><br><span class="line">                    node.y += dy * <span class="number">0.03</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        node.x += node.dx;</span><br><span class="line">        node.y += node.dy;</span><br><span class="line">        node.dx *= node.x &gt; ww || node.x &lt; <span class="number">0</span> ? <span class="number">-1</span> : <span class="number">1</span>;</span><br><span class="line">        node.dy *= node.y &gt; wh || node.y &lt; <span class="number">0</span> ? <span class="number">-1</span> : <span class="number">1</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">    requestAnimationFrame(render);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2018-05-04</span><i class="fa fa-tag"></i><a href="/categories/code/" title="code" class="tag">code </a><a href="/tags/Js/" title="Js" class="tag">Js </a></div></div></div></div><div class="pagination"><span id="busuanzi_container_page_pv">本文总阅读量<span id="busuanzi_value_page_pv"></span>次</span><ul class="clearfix"><li class="pre pagbuttons"><a role="navigation" href="/2018/05/07/nginx的简单命令以及一些配置/" title="nginx的简单命令以及一些配置" class="btn">上一篇</a></li><li class="next pagbuttons"><a role="navigation" href="/2018/05/02/java面试题全集/" title="java面试题全集" class="btn">下一篇</a></li></ul></div><div id="lv-container" data-id="city" data-uid="MTAyMC80MDMyMC8xNjg0Nw=="><script src="/js/libere.js"></script></div></div><div class="rightpane fadeIn"><div class="block aboutme"><div class="content"><h2 class="ab_title">关于我</h2><div class="avatar"><img src="/images/logo.jpg"></div><div class="ab_con"><p>网名：夭夜</p><p>职业：java开发工程师</p><p>微信：Y--night</p><p>邮箱：616834508@qq.com</p></div></div></div><div class="block weixin"><div class="content"><h2 class="wx_title">个人微信</h2><div class="avatar"><img src="/images/weixin.png"></div></div></div><div class="block archives"><h2 class="ar_title">标签</h2><div class="content"><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/"><i class="fa" aria-hidden="true">Java</i></a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Js/"><i class="fa" aria-hidden="true">Js</i></a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring/"><i class="fa" aria-hidden="true">Spring</i></a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kotlin/"><i class="fa" aria-hidden="true">kotlin</i></a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/"><i class="fa" aria-hidden="true">nginx</i></a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/springboot/"><i class="fa" aria-hidden="true">springboot</i></a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/加密/"><i class="fa" aria-hidden="true">加密</i></a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/故事/"><i class="fa" aria-hidden="true">故事</i></a><span class="tag-list-count">1</span></li></ul></div></div></div></div></div><div class="footer"></div><script src="/js/xy-nest.js"></script><script>if(!(/msie [6|7|8|9]/i.test(navigator.userAgent))){
    (function(){
        window.scrollReveal = new scrollReveal({reset: true});
    })();
}</script></body></html>